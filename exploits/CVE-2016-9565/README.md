# CVE-2016-9565

http://www.openwall.com/lists/oss-security/2016/12/20/4
https://legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html

You can find an example of the Apache error log, after successful exploit in
the apache2_error.log file in this repo.

Run the exploit:
```shell
# startup vulnerable VM instance
cd ./ubuntu-12.04/nagios-3.5.1
vagrant up

# on attacker PC
python ./nagios_cmd_injection.py 192.168.56.102

# in vulnerable VM
http://127.0.0.1:8080/nagios3/
http://127.0.0.1:8080/nagios/
# nagiosadmin, nagiosadmin

http://192.168.56.101/nagios/rss-newsfeed.php


# delete various .vagrant folders
find . -name ".vagrant" -type d -exec rm -r "{}" \;
```


## Log Files
```shell
nano /usr/local/nagios/var/nagios.log
nano /var/log/nagios3/nagios.log

sudo watch -n 1 tail -32 /var/log/apache2/error.log
/var/log/apache2/access.log
/var/log/apache2/other_vhosts_access.log
```



## Findings


### Nagios 4.x, on Ubuntu 14.04
```shell
https://sourceforge.net/projects/nagios/files/nagios-4.x/

Tested		Exploited	Comment
4.2.4					# fixed
4.2.3					# fixed
4.2.2					# fixed
4.2.1					# includes RSS reader code, error on run
4.2.0					# includes RSS reader code, error on run
			4.1.1		# needed to visit /rss-newsfeed.php
			4.1.0		# needed to visit /rss-newsfeed.php
			4.0.8		# needed to visit /rss-newsfeed.php
			4.0.7		# needed to visit /rss-newsfeed.php
			4.0.6		# needed to visit /rss-newsfeed.php
			4.0.5		# automatic
			4.0.4		# automatic
			4.0.3		# automatic, no popup
			4.0.2		# automatic, no popup
			4.0.1		# automatic
			4.0.0		# automatic, no popup
```

### Nagios 3.x, on Ubuntu 12.04
```shell
https://sourceforge.net/projects/nagios/files/nagios-3.x/

Available		Tested		Exploited	Comment
							3.5.1		# automatic, on Ubuntu 14.04 and 12.04
							3.5.0		# automatic, on Ubuntu 12.04
							3.4.5rc1	# automatic, no popup
							3.4.4		# automatic, no popup
3.4.3
3.4.2
3.4.1
3.4.0
							3.3.1		# automatic, on Ubuntu 14.04 and 12.04
				3.2.3					# SAFE, does not include RSS reader code
3.2.2
3.2.1
				3.2.0
3.1.2
3.1.1
				3.1.0
3.0.6
3.0.5
3.0.4
3.0.3
3.0.2
3.0.1
				3.0						# does not include RSS reader code
```



### Ubuntu 14.04, Nagios 4.2.1 and 4.2.0

RSS code does not run, error when the RSS Reader file is loaded, with PHP 5.5.9

[Thu Dec 29 18:41:06.017615 2016] [:error] [pid 5254] [client 192.168.56.102:42768] PHP Parse error:  syntax error, unexpected '=' in /usr/local/nagios/share/includes/rss/rss_fetch.inc on line 99




## Thoughts

The severity of these exploits are HIGH, but the likelihood of exploit is MEDIUM.
If you are running Nagios servers on a corporate or private network on-prem,
I think the risk is much higher versus running on a trusted cloud provider
like Amazon. Cloud providers are much more pro-active about preventing DNS spoofing
and ARP cache poisoning. Overall, I would rate this exploit as MEDIUM risk if
you are on a trusted cloud-provider, and HIGH risk if you running Nagios
 servers on-prem or on Rackspace.

More info to determine risk or DNS Spoofing:<br/>
https://thehackerblog.com/the-orphaned-internet-taking-over-120k-domains-via-a-dns-vulnerability-in-aws-google-cloud-rackspace-and-digital-ocean/

- Google Cloud = MEDIUM
- Amazon AWS Route 53 = MEDIUM
- Rackspace = HIGH
- Digital Ocean = MEDIUM
